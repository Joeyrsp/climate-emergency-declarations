{% extends "govtrack/base.html" %}

{% load humanize %}

{% block title %}{{ country.name }} ({{ country.country_code }}){% endblock %}

{% block content %}

<p>Population: {{ country.population | intcomma }}</p>
<p>Region: {{ country.region }}</p>
{% include 'govtrack/links.html' %}


<div class='parent-tree'>
{% for struct in structure_list %}
    <div class='level_{{ struct.level }}' id='nodetype-{{ struct.id }}'>&#8866; {{ struct.name }} ({{ struct.num_records }})
    {% if user.is_authenticated %}
      &nbsp;<button class='view-nodetype' id='viewnodetype-{{ struct.id }}'>*</button>
      <div id='editnodetype-{{ struct.id }}' class='edit-nodetype'>
      <a href='{% url 'nodetype_edit' struct.id %}'>edit</a> | 
      {% if struct.num_records == 0 %}
        {% with view="nodetype_del" object=struct %}
        {% include 'govtrack/delete.html' %}
        {% endwith %}
        |{% endif %}
      <a href='{% url 'nodetype_child' struct.id %}'>add child</a>
      </div>
    {% endif %}
    </div>
{% endfor %}
</div>

<h3>Records</h3>
<table>
  <tr>
    <th></th>
    <th>Declared?</th>
    <th>Population</th>
    <th>Cumulative</th>
    <!--<th>Parent</th>-->
  </tr>
{% for record in records_list %}
    <tr>
    <td>
    <div class='level_{{ record.level }}' id='node-{{ record.id }}'>&#8866;({{ record.nodetype.name }})  <a class='link-node' href='{% url 'node' record.id %}'>{{ record.name }}</a>
    {% if user.is_authenticated %}
      &nbsp;<button class='view-node' id='viewnode-{{ record.id }}'>*</button>
      <div id='editnode-{{ record.id }}' class='edit-node'>
      <a href='{% url 'node_edit' record.id %}'>edit</a>
      {% if record.level > 1 %}
        |
        {% with view="node_del" object=record %}
        {% include 'govtrack/delete.html' %}
        {% endwith %}
      {% endif %}
      <br>
      {% for ctype in record.sub_types %}
        <li><a href='{% url 'node_child' record.id ctype.id  %}'>add {{ ctype.name }}</a></li>
      {% endfor %}
      </div>
    {% endif %}
    </div>
    </td>
    <td align='right'>{% if record.is_declared %}Yes{% endif %}</td>
    <td align='right' {% if not record.is_counted %}class='nocount'{% endif%}>
        {{record.population | intcomma}}
    </td>
    <td align='right'>{{record.total_population | intcomma}}</td>
    <!--<td align='right'>{{record.this_parent.name}}</td>-->
    </tr>
{% endfor %}
  <tr class='total-pop-row'>
    <td>Total population under declaration:</td>
    <td></td>
    <td></td>
    <td align='right'>{{total_declared_population | intcomma}}</td>
  </tr>
</table>

{% endblock %}
